[avr]
exten => s,1,Answer()
 same => n,Ringing()
 same => n,Wait(1)
 same => n,Set(UUID=${SHELL(uuidgen | tr -d '\n')})
 same => n,Set(CALLER_NUM=${CALLERID(num)})
 same => n,Set(CALLER_NAME=${CALLERID(name)})
 same => n,NoOp(=== CALLER ID DEBUG ===)
 same => n,NoOp(CALLERID(all): ${CALLERID(all)})
 same => n,NoOp(CALLERID(num): ${CALLER_NUM})
 same => n,NoOp(CALLERID(name): ${CALLER_NAME})
 same => n,NoOp(CALLERID(ani): ${CALLERID(ani)})
 same => n,NoOp(CALLERID(dnid): ${CALLERID(dnid)})
 same => n,NoOp(CALLERID(rdnis): ${CALLERID(rdnis)})
 same => n,NoOp(CHANNEL: ${CHANNEL})
 same => n,NoOp(EXTEN: ${EXTEN})
 same => n,NoOp(=====================)
 same => n,Set(TIMEOUT(absolute)=600)
 same => n,Set(RESULT=${SHELL(/etc/asterisk/save-caller-id.sh ${UUID} ${CALLER_NUM})})
 same => n,Dial(AudioSocket/${ARG1}/${UUID},120,gKk)
 same => n,NoOp(Dial finished with status: ${DIALSTATUS})
 same => n,Hangup()

exten => h,1,NoOp(Hangup handler - cleaning up call)
 same => n,NoOp(Channel: ${CHANNEL})
 same => n,NoOp(Dialstatus: ${DIALSTATUS})
 same => n,Return()

[from-pstn]
; Contexto para llamadas entrantes desde el HT813
exten => s,1,NoOp(Llamada entrante desde HT813 recibida)
 same => n,NoOp(=== FROM-PSTN CALLER ID DEBUG ===)
 same => n,NoOp(CALLERID(all): ${CALLERID(all)})
 same => n,NoOp(CALLERID(num): ${CALLERID(num)})
 same => n,NoOp(CALLERID(name): ${CALLERID(name)})
 same => n,NoOp(CALLERID(ani): ${CALLERID(ani)})
 same => n,NoOp(CALLERID(dnid): ${CALLERID(dnid)})
 same => n,NoOp(CALLERID(rdnis): ${CALLERID(rdnis)})
 same => n,NoOp(CHANNEL: ${CHANNEL})
 same => n,NoOp(EXTEN: ${EXTEN})
 same => n,NoOp(CONNECTEDLINE(all): ${CONNECTEDLINE(all)})
 same => n,NoOp(REDIRECTING(from-num): ${REDIRECTING(from-num)})
 same => n,NoOp(===================================)
 same => n,GoSub(avr,s,1(avr-core:5001))

exten => ht813,1,NoOp(Llamada entrante desde HT813 recibida)
 same => n,NoOp(=== FROM-PSTN CALLER ID DEBUG (ht813) ===)
 same => n,NoOp(CALLERID(all): ${CALLERID(all)})
 same => n,NoOp(CALLERID(num): ${CALLERID(num)})
 same => n,NoOp(CALLERID(name): ${CALLERID(name)})
 same => n,NoOp(===================================)
 same => n,GoSub(avr,s,1(avr-core:5001))

exten => _X.,1,NoOp(Llamada entrante desde HT813 - cualquier numero)
 same => n,NoOp(=== FROM-PSTN CALLER ID DEBUG (numero: ${EXTEN}) ===)
 same => n,NoOp(CALLERID(all): ${CALLERID(all)})
 same => n,NoOp(CALLERID(num): ${CALLERID(num)})
 same => n,NoOp(CALLERID(name): ${CALLERID(name)})
 same => n,NoOp(EXTEN recibido: ${EXTEN})
 same => n,NoOp(===================================)
 same => n,GoSub(avr,s,1(avr-core:5001))

[demo]

; === EXTENSIÓN POR DEFECTO ===
; Si llamas sin marcar número, automáticamente conecta con AVR
exten => s,1,NoOp(Llamada interna sin extension - redirigiendo a AVR)
 same => n,GoSub(avr,s,1(avr-core:5001))

; === EXTENSIONES DE PRUEBA ===
exten => 5001,1,GoSub(avr,s,1(avr-core:5001))           ; Llamar a AVR Core en contenedor Docker
exten => 5002,1,GoSub(avr,s,1(host.docker.internal:5001)) ; Llamar a AVR Core en host local (desarrollo)


